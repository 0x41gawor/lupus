apiVersion: lupus.gawor.io/v1
kind: Master
metadata:
  labels:
    app.kubernetes.io/name: lupus
    app.kubernetes.io/managed-by: kustomize
  name: lola
spec:
  name: "lola"
  elements:
    - name: "observe1"
      type: observe
      observe:
        next:
          - type: "decide"
            name: "decide1"
            keys: ["*"]
    - name: "decide1"
      type: decide
      decide:
        actions:
          - name: "start"
            type: print
            print:
              inputKeys: ["*"]
            next: "switch-start"
          - name: "switch-start"
            type: switch
            switch:
              conditions:
                - key: "case"
                  operator: eq
                  type: string
                  string: 
                    value: "A"
                  next: "insert-A"
                - key: "case"
                  operator: eq
                  type: string
                  string: 
                    value: "B"
                  next: "insert-B"
                - key: "case"
                  operator: eq
                  type: string
                  string: 
                    value: "C"
                  next: "insert-C"
            next: exit
          - name: "insert-A"
            type: insert
            insert: 
              outputKey: "*"
              value: {"path_taken": "A"}
            next: "switch-ram"
          - name: "insert-B"
            type: insert
            insert:
              outputKey: "*"
              value: {"path_taken": "B"}
            next: "switch-ram"
          - name: "insert-C"
            type: insert
            insert:
              outputKey: "*"
              value: {"path_taken": "C"}
            next: "switch-ram"
          - name: "switch-ram"
            type: switch
            switch:
              conditions:
                - key: "ram"
                  operator: gt
                  type: int
                  int: 
                    value: 10
                  next: "critical"
            next: "normal"
          - name: "critical"
            type: insert
            insert:
              outputKey: "*"
              value: {"log.ram.critical": "yes"}
            next: final
          - name: "normal"
            type: insert
            insert:
              outputKey: "*"
              value: {"log.ram.critical": "no"}
            next: final
        next:
          - type: "execute"
            name: "execute1"
            keys: ["*"]
    - name: "execute1"
      type: execute
      execute:
        destination:
          type: "HTTP"
          http:
            path: "http://192.168.56.111:7000/api/command"
            method: "POST"