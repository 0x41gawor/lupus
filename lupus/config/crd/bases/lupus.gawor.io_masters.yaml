---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.1
  name: masters.lupus.gawor.io
spec:
  group: lupus.gawor.io
  names:
    kind: Master
    listKind: MasterList
    plural: masters
    singular: master
  scope: Namespaced
  versions:
  - name: v1
    schema:
      openAPIV3Schema:
        description: Master is the Schema for the masters API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: MasterSpec defines the desired state of Master
            properties:
              elements:
                description: Elements is a list of elements, each with its name, type,
                  and corresponding spec
                items:
                  description: Element is a polymorphic structure that can represent
                    different types of specs
                  properties:
                    decide:
                      description: DecideSpec defines the desired state of Decide
                      properties:
                        actions:
                          description: Actions is a list of Actions that Decide has
                            to perform see Action in types.go
                          items:
                            description: |-
                              Action is used in Decide spec
                              It represents the Action that Decide has to perform on Data
                            properties:
                              duplicate:
                                properties:
                                  inputKey:
                                    type: string
                                  outputKey:
                                    type: string
                                required:
                                - inputKey
                                - outputKey
                                type: object
                              insert:
                                properties:
                                  outputKey:
                                    type: string
                                  value:
                                    type: object
                                    x-kubernetes-preserve-unknown-fields: true
                                required:
                                - outputKey
                                - value
                                type: object
                              name:
                                description: Name of the Action, it is for designer
                                  to ease the management of the Loop
                                type: string
                              nest:
                                properties:
                                  inputKeys:
                                    items:
                                      type: string
                                    type: array
                                  outputKey:
                                    type: string
                                required:
                                - inputKeys
                                - outputKey
                                type: object
                              next:
                                description: Next is the name of the next action to
                                  execute, in the case of Action type Switch it is
                                  the default branch
                                type: string
                              print:
                                properties:
                                  inputKeys:
                                    items:
                                      type: string
                                    type: array
                                required:
                                - inputKeys
                                type: object
                              remove:
                                properties:
                                  inputKeys:
                                    items:
                                      type: string
                                    type: array
                                required:
                                - inputKeys
                                type: object
                              rename:
                                properties:
                                  inputKey:
                                    type: string
                                  outputKey:
                                    type: string
                                required:
                                - inputKey
                                - outputKey
                                type: object
                              send:
                                description: One of these fields is not null depending
                                  on a Type.
                                properties:
                                  destination:
                                    description: |-
                                      Destination in Action type and in Learn Spec
                                      Destination is a polymorphic field that can represent different types
                                    properties:
                                      file:
                                        description: File-specific fields
                                        properties:
                                          path:
                                            type: string
                                        required:
                                        - path
                                        type: object
                                      grpc:
                                        description: gRPC-specific fields
                                        properties:
                                          host:
                                            type: string
                                          method:
                                            type: string
                                          service:
                                            type: string
                                        required:
                                        - host
                                        - method
                                        - service
                                        type: object
                                      http:
                                        description: HTTP-specific fields
                                        properties:
                                          method:
                                            type: string
                                          path:
                                            type: string
                                        required:
                                        - method
                                        - path
                                        type: object
                                      opa:
                                        description: Opa-specific fields
                                        properties:
                                          path:
                                            type: string
                                        required:
                                        - path
                                        type: object
                                      type:
                                        description: 'Discriminator: "HTTP", "FILE",
                                          "gRPC", etc.'
                                        type: string
                                    required:
                                    - type
                                    type: object
                                  inputKey:
                                    type: string
                                  outputKey:
                                    type: string
                                required:
                                - destination
                                - inputKey
                                - outputKey
                                type: object
                              switch:
                                properties:
                                  conditions:
                                    items:
                                      description: Condition represent signle condition
                                        present in Switch action.
                                      properties:
                                        bool:
                                          description: BoolCondition specifies the
                                            condition for boolean values
                                          properties:
                                            value:
                                              type: boolean
                                          required:
                                          - value
                                          type: object
                                        int:
                                          description: IntCondition specifies the
                                            condition for integer values
                                          properties:
                                            value:
                                              type: integer
                                          required:
                                          - value
                                          type: object
                                        key:
                                          description: Key indicates the field of
                                            Data that has to be retrieved
                                          type: string
                                        next:
                                          description: Next specifies the name of
                                            the next action to execute
                                          type: string
                                        operator:
                                          description: Operator defines the comparison
                                            operation, e.g., eq, ne, gt, lt
                                          type: string
                                        string:
                                          description: StringCondition specifies the
                                            condition for string values
                                          properties:
                                            value:
                                              type: string
                                          required:
                                          - value
                                          type: object
                                        type:
                                          description: 'Type specifies the type of
                                            the value: string, int, float, bool'
                                          type: string
                                      required:
                                      - key
                                      - next
                                      - operator
                                      - type
                                      type: object
                                    type: array
                                required:
                                - conditions
                                type: object
                              type:
                                description: Type of Action one of send;nest,remove,rename,duplicate
                                type: string
                            required:
                            - name
                            - next
                            - type
                            type: object
                          type: array
                        master:
                          description: Name of master element
                          type: string
                        next:
                          description: Next is a list of elements to which send the
                            output
                          items:
                            description: |-
                              Next is used in Observe Spec
                              It specifies to which element forward the input
                              It allows not to forward the whole input, but also parts of it
                            properties:
                              keys:
                                description: |-
                                  List of input keys (data fields) that have to be forwarded
                                  Pass array with single element '*' to forward the whole input
                                items:
                                  type: string
                                type: array
                              name:
                                description: |-
                                  Kubernetes name of the API Object
                                  This is the name that you give in Master CR spec
                                type: string
                              type:
                                description: Type specifies the type of the element
                                  ("Observe", "Decide", "Learn", "Execute", etc.)
                                type: string
                            required:
                            - keys
                            - name
                            - type
                            type: object
                          type: array
                      type: object
                    execute:
                      description: ExecuteSpec defines the desired state of Execute
                      properties:
                        destination:
                          description: |-
                            Destination specifies where the input of Execute has to be sent
                            It will be always of type HTTP since this is what Lupout interface specifies it to be, but we will reuse the known
                          properties:
                            file:
                              description: File-specific fields
                              properties:
                                path:
                                  type: string
                              required:
                              - path
                              type: object
                            grpc:
                              description: gRPC-specific fields
                              properties:
                                host:
                                  type: string
                                method:
                                  type: string
                                service:
                                  type: string
                              required:
                              - host
                              - method
                              - service
                              type: object
                            http:
                              description: HTTP-specific fields
                              properties:
                                method:
                                  type: string
                                path:
                                  type: string
                              required:
                              - method
                              - path
                              type: object
                            opa:
                              description: Opa-specific fields
                              properties:
                                path:
                                  type: string
                              required:
                              - path
                              type: object
                            type:
                              description: 'Discriminator: "HTTP", "FILE", "gRPC",
                                etc.'
                              type: string
                          required:
                          - type
                          type: object
                        master:
                          description: Name of master element
                          type: string
                      required:
                      - destination
                      type: object
                    name:
                      description: Name is the name of the element
                      type: string
                    observe:
                      description: ObserveSpec defines the desired state of Observe
                      properties:
                        master:
                          description: Name of master element
                          type: string
                        next:
                          description: List of elements of to which forward the input
                          items:
                            description: |-
                              Next is used in Observe Spec
                              It specifies to which element forward the input
                              It allows not to forward the whole input, but also parts of it
                            properties:
                              keys:
                                description: |-
                                  List of input keys (data fields) that have to be forwarded
                                  Pass array with single element '*' to forward the whole input
                                items:
                                  type: string
                                type: array
                              name:
                                description: |-
                                  Kubernetes name of the API Object
                                  This is the name that you give in Master CR spec
                                type: string
                              type:
                                description: Type specifies the type of the element
                                  ("Observe", "Decide", "Learn", "Execute", etc.)
                                type: string
                            required:
                            - keys
                            - name
                            - type
                            type: object
                          type: array
                      type: object
                    type:
                      description: Type specifies the type of the element ("Observe",
                        "Decide", "Learn", "Execute", etc.)
                      type: string
                  required:
                  - name
                  - type
                  type: object
                type: array
              name:
                description: Name of the Master CR
                type: string
            required:
            - elements
            - name
            type: object
          status:
            description: MasterStatus defines the observed state of Master
            properties:
              isActive:
                description: Active flag. If set to true, the loop elements are running,
                  if not the controller will instantiate them
                type: boolean
            required:
            - isActive
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
